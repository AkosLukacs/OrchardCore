@model ContentTypesSitemapViewModel
@using OrchardCore.Sitemaps.Models
<h5>@T["Content Types"]</h5>

<div class="row">
    <div class="col col-xl-9">
        @*General fields*@
        <div class="form-group" asp-validation-class-for="Name">
            <label asp-for="Name">@T["Name"]</label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name"></span>
            <span class="hint">@T["Name of the sitemap"]</span>
        </div>
        <div class="form-group" asp-validation-class-for="Path">
            <label asp-for="Path">@T["Path"]</label>
            <div class="input-group">
                @{
                    var prependPath = Context.Request.PathBase.HasValue ? Site.BaseUrl + Context.Request.PathBase.Value : Site.BaseUrl;
                    prependPath = prependPath + '/';
                }
                @if (!String.IsNullOrWhiteSpace(prependPath))
                {
                    <div class="input-group-prepend">
                        <div class="input-group-text">@prependPath</div>
                    </div>
                }
                <input asp-for="Path" class="form-control" />
                <span asp-validation-for="Path"></span>
            </div>
        </div>

        @*Panel Switcher*@
        <div class="form-group custom-control custom-checkbox">
            <input asp-for="IndexAll" class="custom-control-input" id="ContentTypesSitemap_IndexAll" />
            <label asp-for="IndexAll" class="custom-control-label">@T["Index All Content Types"]</label>
        </div>

        @*Index All Panel*@
        <div id="index-all-card" class="card mb-4 @(Model.IndexAll ? "" : "collapse")">
            <div class="card-header">
                @T["Index All Content Types"]
            </div>
            <div class="card-body">
                <div class="form-group" asp-validation-class-for="ChangeFrequency">
                    <label asp-for="ChangeFrequency">@T["Change Frequency"] </label>
                    <select asp-for="ChangeFrequency" class="form-control w-25" asp-items="Html.GetEnumSelectList<ChangeFrequency>()"></select>
                    <span class="hint">@T["The default frequency these content types are likely to change."]</span>
                </div>
                <div class="form-group" asp-validation-class-for="Priority">
                    <label asp-for="Priority">@T["Priority"] </label>
                    <select asp-for="Priority" class="form-control w-25">
                        <option value="0.0">0.0</option>
                        <option value="0.1">0.1</option>
                        <option value="0.2">0.2</option>
                        <option value="0.3">0.3</option>
                        <option value="0.4">0.4</option>
                        <option value="0.5">0.5</option>
                        <option value="0.6">0.6</option>
                        <option value="0.7">0.7</option>
                        <option value="0.8">0.8</option>
                        <option value="0.9">0.9</option>
                        <option value="1.0">1.0</option>
                        @* TODO JT had problems. Convert the value of these to integers and convert back as producing is the simple answer.
                            I was not able to set and save any Priority, the problem is due to the decimal separator in french culture, 
                            i needed to switch to the en-us culture. It's always a problem with numbers, maybe you could just use integer values.
                            Then , when a validation fails, the priority dropdown lists are not accessible anymore.
                            
                            *@
                    </select>
                    <span class="hint">@T["The default priority of these content types relative to other content on your site."]</span>
                </div>
            </div>
        </div>

        @*Selection Panel*@
        <div id="index-selected-card" class="card mb-4">
            <div class="card-header">
                @T["Select Content Types"]
            </div>
            <div class="card-body px-4">
                <ul class="list-group">
                    @for (int i = 0; i < Model.ContentTypes.Count(); i++)
                    {
                        var checkd = Model.ContentTypes[i].IsChecked;
                        var notChecked = !checkd;
                        var takeAll = Model.ContentTypes[i].TakeAll;
                        <li class="list-group-item d-flex row px-0">
                            <div class="col-12 col-md-3">
                                <input type="hidden" name="@Html.NameFor(m => m.ContentTypes[i].ContentTypeName)"
                                       value="@Model.ContentTypes[i].ContentTypeName" />
                                <div class="form-group custom-control custom-checkbox">
                                    <input asp-for="ContentTypes[i].IsChecked" class="custom-control-input content-type-checkbox" />
                                    <label asp-for="ContentTypes[i].IsChecked" class="custom-control-label">@Model.ContentTypes[i].ContentTypeDisplayName</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-3 ">
                                <div class="form-group" asp-validation-class-for="ContentTypes[i].ChangeFrequency">
                                    <label asp-for="ContentTypes[i].ChangeFrequency">@T["Change Frequency"] </label>
                                    <select asp-for="ContentTypes[i].ChangeFrequency" class="form-control" asp-items="Html.GetEnumSelectList<ChangeFrequency>()" disabled="@notChecked"></select>
                                    <span class="hint">@T["The default frequency these content types are likely to change."]</span>
                                </div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="form-group" asp-validation-class-for="ContentTypes[i].Priority">
                                    <label asp-for="ContentTypes[i].Priority">@T["Priority"] </label>
                                    <select asp-for="ContentTypes[i].Priority" class="form-control" disabled="@notChecked">
                                        <option value="0.0">0.0</option>
                                        <option value="0.1">0.1</option>
                                        <option value="0.2">0.2</option>
                                        <option value="0.3">0.3</option>
                                        <option value="0.4">0.4</option>
                                        <option value="0.5">0.5</option>
                                        <option value="0.6">0.6</option>
                                        <option value="0.7">0.7</option>
                                        <option value="0.8">0.8</option>
                                        <option value="0.9">0.9</option>
                                        <option value="1.0">1.0</option>
                                    </select>
                                    <span class="hint">@T["The default priority of these content types relative to other content on your site."]</span>
                                </div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="d-flex flex-column justify-content-center content-types-take-container">
                                    <div class="form-group custom-control custom-checkbox d-flex mb-2">
                                        <input asp-for="ContentTypes[i].TakeAll" class="custom-control-input content-types-take-all-checkbox" disabled="@notChecked" />
                                        <label asp-for="ContentTypes[i].TakeAll" class="custom-control-label">@T["Include all"]</label>
                                    </div>
                                    <div class="form-group form-inline" style="@(takeAll ? "display: none" : "")">
                                        <label asp-for="ContentTypes[i].Skip" class="form-label pr-3">@T["Skip"]</label>
                                        <input asp-for="ContentTypes[i].Skip" class="form-control" disabled="@notChecked" />
                                    </div>
                                    <div class="form-group form-inline" style="@(takeAll ? "display: none" : "")">
                                        <label asp-for="ContentTypes[i].Take" class="form-label pr-3">@T["Take"]</label>
                                        <input asp-for="ContentTypes[i].Take" class="form-control" disabled="@notChecked" />
                                    </div>
                                    <span class="hint">@T["Adjust quantity of content items in sitemap."]</span>
                                </div>
                            </div>
                        </li>
                    }
                </ul>
                <span class="hint">@T["The content types to add to the sitemap."]</span>
            </div>
        </div>
    </div>
</div>

<script at="Foot" depends-on="jquery">
    $(function () {
        $('.content-type-checkbox').on('click', function (e) {
            var listItem = $(e.target).closest('.list-group-item');

            var selected = $(e.target).prop('checked');
            $(listItem).find('select, input:not(.content-type-checkbox)').each(function () {
                selected ? $(this).prop('disabled', false) : $(this).prop('disabled', 'disabled');
            });
        });

        $('.content-types-take-all-checkbox').change(function (e) {
            var checked = $(e.target).prop('checked');
            $(e.target).closest('.content-types-take-container').find('input[type="number"]').each(function () {
                var formGroup = $(this).closest('.form-group');
                checked ? formGroup.hide() : formGroup.show();
            });
        });

        switchContentTypesCheckBoxes();
        $('#ContentTypesSitemap_IndexAll').change(function () {
            switchContentTypesCheckBoxes();
        });

        function switchContentTypesCheckBoxes() {
            var indexAll = $('#ContentTypesSitemap_IndexAll').prop('checked');
            if (indexAll) {
                $('#index-all-card').show();
                $('#index-selected-card').hide();
            } else {
                $('#index-all-card').hide();
                $('#index-selected-card').show();
            }
        }
    });
</script>

