@model ShapeViewModel<ContentTypesSitemapNode>
@using OrchardCore.ContentManagement.Metadata.Models

@inject OrchardCore.ContentManagement.Metadata.IContentDefinitionManager ContentDefinitionManager
@inject OrchardCore.Settings.ISiteService SiteService
@inject OrchardCore.Environment.Shell.ShellSettings ShellSettings
@{
    var allContentTypes = ContentDefinitionManager.ListTypeDefinitions();

    var selectedContentTypes = Model.Value.ContentTypes ?? new ContentTypeSitemapEntry[] { };

    var selectedDisplayNames = allContentTypes
        .Where(ctd => selectedContentTypes.Any(sct => sct.ContentTypeName == ctd.Name))
        .Select(x => x.DisplayName)
        .ToList();

    //bool isSelected(ContentTypeDefinition ctd, ContentTypeSitemapEntry[] selectedList)
    //{
    //    return selectedList.Any(selected => ctd.Name == selected.ContentTypeName);
    //}
    var site = await SiteService.GetSiteSettingsAsync();
}

<div class="@(Model.Value.Enabled ? " " : " disabled")">
    <span>@Model.Value.Description</span>
    @{
        var tenantPrefix = (ShellSettings.RequestUrlPrefix ?? string.Empty).TrimEnd('/');
        var path = Model.Value.SitemapSet.RootPath + Model.Value.Path;
        path = !String.IsNullOrEmpty(tenantPrefix) ? tenantPrefix + path : path;
    }
    <code>@path</code>

    @if (selectedDisplayNames.Any())
    {
        foreach (var displayName in selectedDisplayNames)
        {
            <span class="badge badge-info">@displayName</span>
        }
    }
    else
    {
        <span class="badge badge-warning">@T["Nothing here!"]</span>
    }
    <span class="text-muted">- @T["Sitemap Content Types"]</span>
</div>
